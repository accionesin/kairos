<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Acciones.in ‚Äì Detecci√≥n de in-prendedores</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      padding: 30px;
      max-width: 720px;
      margin: auto;
    }
    h1 {
      color: #38bdf8;
    }
    .box {
      background: #020617;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input[type="text"],
    input[type="file"],
    button {
      width: 100%;
      margin-top: 8px;
      padding: 10px;
      border-radius: 6px;
      border: none;
    }
    input[type="text"] {
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #334155;
    }
    button {
      background: #38bdf8;
      color: #020617;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background: #0ea5e9;
    }
    .note {
      font-size: 0.9em;
      color: #94a3b8;
      margin-top: 5px;
    }
    #preview {
      margin-top: 15px;
      max-width: 100%;
      border-radius: 6px;
      display: none;
    }
    #result {
      margin-top: 20px;
      background: #020617;
      padding: 15px;
      border-radius: 6px;
    }
    .ok {
      color: #22c55e;
      font-weight: bold;
    }
    .error {
      color: #ef4444;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>üîç Acciones.in ‚Äì Detecci√≥n de in-prendedores</h1>

  <div class="box">
    <h3>Opci√≥n 1: Adjuntar imagen</h3>
    <input type="file" id="fileInput" accept="image/*" />
    <div class="note">Imagen JPG o PNG, tama√±o moderado recomendado.</div>
  </div>

  <div class="box">
    <h3>Opci√≥n 2: URL p√∫blica de imagen</h3>
    <input type="text" id="imageUrl" placeholder="https://ejemplo.com/imagen.jpg" />
    <div class="note">‚ö†Ô∏è La imagen debe ser p√∫blica y accesible sin login.</div>
  </div>

  <button onclick="sendToWorker()">Analizar rostro</button>

  <img id="preview" />

  <div id="result"></div>

  <script>
    const WORKER_URL = "https://kairos.clubempx.workers.dev/";

    function sendToWorker() {
      const fileInput = document.getElementById("fileInput");
      const imageUrl = document.getElementById("imageUrl").value.trim();
      const resultDiv = document.getElementById("result");
      const preview = document.getElementById("preview");

      resultDiv.innerHTML = "‚è≥ Analizando imagen...";
      preview.style.display = "none";

      if (fileInput.files.length > 0) {
        const reader = new FileReader();
        reader.onload = function () {
          preview.src = reader.result;
          preview.style.display = "block";
          postImage({ image: reader.result });
        };
        reader.readAsDataURL(fileInput.files[0]);
        return;
      }

      if (imageUrl) {
        preview.src = imageUrl;
        preview.style.display = "block";
        postImage({ image: imageUrl });
        return;
      }

      resultDiv.innerHTML = "<span class='error'>‚ùå Debes adjuntar una imagen o ingresar una URL.</span>";
    }

    function postImage(payload) {
      fetch(WORKER_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(data => renderResult(data))
      .catch(() => {
        document.getElementById("result").innerHTML =
          "<span class='error'>‚ùå Error al conectar con el servicio.</span>";
      });
    }

    function renderResult(data) {
      const resultDiv = document.getElementById("result");

      try {
        const face = data.images[0].faces[0];
        resultDiv.innerHTML = `
          <p class="ok">‚úÖ Rostro detectado correctamente</p>
          <p><strong>Edad estimada:</strong> ${face.attributes.age} a√±os</p>
          <p><strong>G√©nero:</strong> ${face.attributes.gender.type === "M" ? "Masculino" : "Femenino"}</p>
          <p><strong>Confianza:</strong> ${(face.confidence * 100).toFixed(2)}%</p>
        `;
      } catch (e) {
        resultDiv.innerHTML =
          "<span class='error'>‚ùå No se detect√≥ ning√∫n rostro en la imagen.</span>";
      }
    }
  </script>

</body>
</html>
